\begin{exer}[3.1]
    $ $
    \begin{enumerate}[label=(\alph*)]
        \item
            First, as mentioned on P.42, it technically does not make sense to discuss validity of an open formula.
            The convention is to take the universal closure of the formula.
            Thus we will prove that the formula $F: \forall x, y.\, f(x, y) = f(y, x) \rightarrow f(a, y) = f(y, a)$ is invalid.
            We will do so by finding a falsifying $T_{\textsf{E}}$-interpretation.
            In other words, we need to show that
            \begin{itemize}
                \item
                    We have an interpretation $I$ which satisfies all the axioms of $T_{\textsf{E}}$, and
                \item
                    $I \not\models F$.
            \end{itemize}
            Let an interpretation $I: \{ D_I, \alpha_I \}$ be defined such that
            \begin{itemize}
                \item
                    $D_I = \{ \circ, \bullet \}$ and the equaltiy among $\circ$ and $\bullet$ is defined in the most trivial way.
                    (e.g., $\circ = \circ$ and $\circ \ne \bullet$.)
                \item
                    $\alpha_I[a] = \circ$.
                \item
                    $\alpha_I[f]$ is the left projection map.
                    In other words,
                    \begin{itemize}
                        \item
                            $\alpha_I[f](\circ, \circ) = \circ$,
                        \item
                            $\alpha_I[f](\circ, \bullet) = \circ$,
                        \item
                            $\alpha_I[f](\bullet, \circ) = \bullet$,
                        \item
                            $\alpha_I[f](\bullet, \bullet) = \bullet$.
                    \end{itemize}
            \end{itemize}
            Then $I$ is a $T_{\textsf{E}}$-interpretation for it satisfies all the axioms of $T_{\textsf{E}}$ on P.71.
            For instance, $I$ satisfies reflexivity since
            \begin{align*}
                &I \models \forall x.\, x = x \\
                &\text{iff}\quad I \vartriangleleft \{ x \mapsto \textsf{v} \} \models x = x \text{ for any $\textsf{v} \in D_I$ (P.41)}
            \end{align*}
            which we can easily see as \textsf{true} by examining the two cases where \textsf{v} is $\circ$ and $\bullet$.
            It is easy to show that $I$ satisfies the other four axioms (symmetry, transitivity, function congruence, predicate congruence) in a similar way.

            Now that we have established that $I$ is indeed a $T_{\textsf{E}}$-interpretation, we claim that it is a falsifying interpretation of the given formula.
            In other words, we want to show that $I \not\models F$.
            \begin{align*}
                &I \not\models \forall x, y.\, f(x, y) = f(y, x) \rightarrow f(a, y) = f(y, a) \\
                &\text{iff}\quad I \models \neg(\forall x, y.\, f(x, y) = f(y, x) \rightarrow f(a, y) = f(y, a)) \quad\text{(P.40)} \\
                &\text{iff}\quad I \models \exists x, y.\, f(x, y) = f(y, x) \land \neg(f(a, y) = f(y, a)) \quad\text{(NNF)} \\
                &\text{iff}\quad \text{for some \textsf{v}, \textsf{w}, } I_{\textsf{vw}} \models f(x, y) = f(y, x) \land \neg(f(a, y) = f(y, a)) \quad\text{(P.41)} \\
                &\text{iff}\quad \text{for some \textsf{v}, \textsf{w}, } I_{\textsf{vw}} \models f(x, y) = f(y, x) \text{ and } I_{\textsf{vw}} \not\models f(a, y) = f(y, a) \quad\text{(P.40)}
            \end{align*}
            where $I_{\textsf{vw}}$ is used as a shorthand for $I \vartriangleleft \{ x \mapsto \textsf{v}, y \mapsto \textsf{w} \}$.
            The last line is true because when we set $\textsf{v} = \textsf{w} = \bullet$, we have
            \begin{align*}
                & I_{\bullet\bullet} \models f(x, y) = f(y, x) \\
                &\text{iff}\quad \alpha_{I_{\bullet\bullet}}[f](\alpha_{I_{\bullet\bullet}}[x], \alpha_{I_{\bullet\bullet}}[y]) = \alpha_{I_{\bullet\bullet}}[f](\alpha_{I_{\bullet\bullet}}[y], \alpha_{I_{\bullet\bullet}}[x]) \\
                &\text{iff}\quad \alpha_{I}[f](\bullet, \bullet) = \alpha_{I}[f](\bullet, \bullet) \\
                &\text{iff}\quad \bullet = \bullet,
            \end{align*}
            and
            \begin{align*}
                & I_{\bullet\bullet} \not\models f(a, y) = f(y, a) \\
                &\text{iff}\quad \alpha_{I_{\bullet\bullet}}[f](\alpha_{I_{\bullet\bullet}}[a], \alpha_{I_{\bullet\bullet}}[y]) = \alpha_{I_{\bullet\bullet}}[f](\alpha_{I_{\bullet\bullet}}[y], \alpha_{I_{\bullet\bullet}}[a]) \text{ is \textsf{false}}\\
                &\text{iff}\quad \alpha_{I}[f](\circ, \bullet) = \alpha_{I}[f](\bullet, \circ) \text{ is \textsf{false}}\\
                &\text{iff}\quad \circ = \bullet \text{ is \textsf{false}}.
            \end{align*}
        \item
            Suppose $F$ is invalid. Then there must exist a falsifying $T_{\textsf{E}}$-interpretation $I$.
            \begin{enumerate}[label=\arabic*.]
                \item % 1
                    $I \not\models \forall x, y.\, f(g(x)) = g(f(x)) \land f(g(f(y))) = x \land f(y) = x \rightarrow g(f(x)) = x$.
                \item % 2
                    $I_{\textsf{vw}} \not\models f(g(x)) = g(f(x)) \land f(g(f(y))) = x \land f(y) = x \rightarrow g(f(x)) = x$ for fresh \textsf{v, w} where $I_{\textsf{vw}}: I \vartriangleleft \{ x \mapsto \textsf{v}, y \mapsto \textsf{w} \}$ (by 1 and $\forall$ on P.62)
                \item % 3
                    $I_{\textsf{vw}} \models f(g(x)) = g(f(x)) \land f(g(f(y))) = x \land f(y) = x$ (by 2 and $\rightarrow$ on P.10)
                \item % 4
                    $I_{\textsf{vw}} \not\models g(f(x)) = x$ (by 2 and $\rightarrow$ on P.10)
                \item % 5
                    $I_{\textsf{vw}} \models f(g(x)) = g(f(x))$ (by 3 and $\land$ on P.10)
                \item % 6
                    $I_{\textsf{vw}} \models f(g(f(y))) = x$ (by 3 and $\land$ on P.10)
                \item % 7
                    $I_{\textsf{vw}} \models f(y) = x$ (by 3 and $\land$ on P.10)
                \item % 8
                    $I_{\textsf{vw}} \models g(f(y)) = g(x)$ (by 7 and \textsf{(function congruence)})
                \item % 9
                    $I_{\textsf{vw}} \models f(g(f(y))) = f(g(x))$ (by 8 and \textsf{(function congruence)})
                \item % 10
                    $I_{\textsf{vw}} \models x = f(g(f(y)))$ (by 6 and \textsf{(symmetry)})
                \item % 11
                    $I_{\textsf{vw}} \models x = f(g(x))$ (by 9, 10 and \textsf{(transitivity)})
                \item % 12
                    $I_{\textsf{vw}} \models x = g(f(x))$ (by 5, 11 and \textsf{(transitivity)})
                \item % 13
                    $I_{\textsf{vw}} \models g(f(x)) = x$ (by 12 and \textsf{(symmetry)})
                \item % 14
                    $I_{\textsf{vw}} \models \bot$ (by 4 and 13)
            \end{enumerate}
            Since the only one branch closes, the given formula is valid.
            Note that we are able to apply \textsf{(function congruence)}, \textsf{(symmetry)}, and \textsf{(transitivity)} because $I$ is a $T_{\textsf{E}}$-interpretation.
        \item
            Suppose $F$ is invalid.
            Then there must exist a falsifying $T_{\textsf{E}}$-interpretation $I$.
            \begin{enumerate}[label=\arabic*.]
                \item % 1
                    $I \not\models f(f(f(a))) = f(f(a)) \land f(f(f(f(a)))) = a \rightarrow f(a) = a$.
                \item % 2
                    $I \models f(f(f(a))) = f(f(a)) \land f(f(f(f(a)))) = a$ (by 1 and $\rightarrow$)
                \item % 3
                    $I \not\models f(a) = a$ (by 1 and $\rightarrow$)
                \item % 4
                    $I \models f(f(f(a))) = f(f(a))$ (by 2 and $\land$)
                \item % 5
                    $I \models f(f(f(f(a)))) = a$ (by 2 and $\land$)
                \item % 6
                    $I \models f(f(a)) = f(f(f(a)))$ (by 4 and \textsf{(symmetry)})
                \item % 7
                    $I \models f(f(f(a))) = f(f(f(f(a))))$ (by 6 and \textsf{(function congruence)})
                \item % 8
                    $I \models f(f(f(a))) = a$ (by 5, 7, and \textsf{(transitivity)})
                \item % 9
                    $I \models f(f(f(f(a)))) = f(a)$ (by 8 and \textsf{(function congruence)})
                \item % 10
                    $I \models f(a) = f(f(f(f(a))))$ (by 9 and \textsf{(symmetry)})
                \item % 11
                    $I \models f(a) = a$ (by 5, 10 and \textsf{(transitivity)})
                \item % 12
                    $I \models \bot$ (by 3 and 11)
            \end{enumerate}
            Thus the given formula is valid.
        \item
            We claim that $F$ is invalid by identifying a falsifying $T_{\textsf{E}}$-interpretation.
            Let $I: (\alpha_I, D_I)$ be defined such that
            \begin{itemize}
                \item
                    $D_I = \{ 0, 1 \}$.
                \item
                    $\alpha_I[f](0) = 1, \alpha_I[f](1) = 0$.
                \item
                    $a \mapsto 0$.
            \end{itemize}
            Then $I$ is a $T_{\textsf{E}}$-interpretation as it satisfies all the axioms of $T_{\textsf{E}}$.
            For instance, it satisfies function congruence since $I \models \forall x, y.\, x = y \implies f(x) = f(y)$.
            \begin{align*}
                &I \not\models f(f(f(a))) = f(a) \land f(f(a)) = a \rightarrow f(a) = a \\
                &\text{iff}\quad I \models f(f(f(a))) = f(a) \land f(f(a)) = a \land \neg(f(a) = a) \quad\text{(NNF)}\\
                &\text{iff}\quad I \models f(f(f(a))) = f(a) \text{ and } I \models f(f(a)) = a \text{ and } I \models \neg(f(a) = a) \quad\text{(by $\land$)}
            \end{align*}
            where each of the three expressions in the last line is true.
            For instance, $\alpha_{I}[f](\alpha_I[f](\alpha_I[a])) = \alpha_I[a]$ if and only if $0 = 0$.
            The other two expressions can be evaluated in the same way.
            Therefore, $I$ is indeed a falsifying $T_{\textsf{E}}$-interpretation of $F$, and thus $F$ is invalid.
    \end{enumerate}
\end{exer}

\begin{exer}[3.2]
    $ $
    \begin{enumerate}[label=(\alph*)]
        \item
            We claim that any $T_{\mathbb{Z}}$-interpretation is a counterexample.
            Let $I$ be a $T_{\mathbb{Z}}$-interpretation.
            Given $\textsf{a, b, c} \in D_I$, let $I_{\textsf{abc}}: I \vartriangleleft \{ x \mapsto \textsf{a}, y \mapsto \textsf{b}, z \mapsto \textsf{c} \}$ for convenience.
            \begin{align*}
                &I \not\models \forall x, y, z.\, x \leq y \land z = x + 1 \rightarrow z \leq y \\
                &\text{iff}\quad I \models \exists x, y, z.\, x \leq y \land z = x + 1 \land \neg(z \leq y) \\
                &\text{iff}\quad \text{For some \textsf{a, b, c}, } I_{\textsf{abc}} \models x \leq y \land z = x + 1 \land \neg(z \leq y) \\
                &\text{iff}\quad \text{For some \textsf{a, b, c}, } I_{\textsf{abc}} \models x \leq y \text{ and } I_{\textsf{abc}} \models z = x + 1 \text{ and } I_{\textsf{abc}} \models \neg(z \leq y).
            \end{align*}
            The last line is equivalent to asking the existence of \textsf{a, b, c} such that $\textsf{a} \leq \textsf{b}$, $\textsf{c} = \textsf{a} + 1$, and $\textsf{c} > \textsf{b}$.
            It is true because, for instance, the tuple $(\textsf{a}, \textsf{b}, \textsf{c}) = (0, 0, 1)$ satisfies all the three expressions simultaneously.
        \item
            We claim that the given formula is valid.
            Suppose otherwise.
            Let $I$ be a falsifying $T_{\mathbb{Z}}$-interpretation.
            \begin{enumerate}[label=\arabic*.]
                \item
                    $I \not\models \forall x, y, z.\, x \leq y \land z = x - 1 \rightarrow z \leq y$.
                \item
                    $I \models \exists x, y, z.\, x \leq y \land z = x - 1 \land \neg(z \leq y)$.
                \item
                    $I_{\textsf{abc}} \models x \leq y \land z = x - 1 \land \neg(z \leq y)$ where $I_{\textsf{abc}}: I \vartriangleleft \{ x \mapsto \textsf{a}, y \mapsto \textsf{b}, z \mapsto \textsf{c} \}$ for some $\textsf{a, b, c} \in D_I$.
                \item
                    $I_{\textsf{abc}} \models x \leq y$, $I_{\textsf{abc}} \models z = x - 1$ and $I_{\textsf{abc}} \models \neg(z \leq y)$ where $I_{\textsf{abc}}: I \vartriangleleft \{ x \mapsto \textsf{a}, y \mapsto \textsf{b}, z \mapsto \textsf{c} \}$ for some $\textsf{a, b, c} \in D_I$.
            \end{enumerate}
            The last line is equivalent to the existence of $\textsf{a, b, c}$ such that $\textsf{a} \leq \textsf{b}$, $\textsf{c} = \textsf{a} - 1$, and $\textsf{c} > \textsf{b}$.
            Since $\textsf{c} = \textsf{a} - 1 < \textsf{a} \leq \textsf{b} < \textsf{c}$ would imply that $\textsf{c} < \textsf{c}$, there is no such tuple.
            Thus the original formula must be valid.
        \item
            We claim that the given formula is valid.
            Suppose otherwise.
            Let $I$ be a falsifying $T_{\mathbb{Z}}$-interpretation.
            \begin{enumerate}[label=\arabic*.]
                \item
                    $I \not\models \forall x.\, 3x = 2 \rightarrow x \leq 0$.
                \item
                    $I \models \exists x.\, 3x = 2 \land \neg(x \leq 0)$.
                \item
                    $I_{\textsf{a}} \models 3x = 2 \land \neg(x \leq 0)$ for some $\textsf{a} \in D_I$.
                \item
                    $I_{\textsf{a}} \models 3x = 2$ and $I_{\textsf{a}} \models \neg(x \leq 0)$ for some $\textsf{a} \in D_I$.
            \end{enumerate}
            The last line is equivalent to the existence of \textsf{a} such that $3\textsf{a} = 2$ and $\textsf{a} > 0$.
            Since no integer satisfies $3\textsf{a} = 2$, this is a contradiction.
            Therefore, the original formula is valid.
    \end{enumerate}
\end{exer}

\begin{exer}[3.3]
    $ $
    \begin{enumerate}[label=(\alph*)]
        \item
            We claim that any $T_{\mathbb{Q}}$-interpretation is a falsifying interpretation.
            Let $I$ be a $T_{\mathbb{Q}}$-interpretation.
            \begin{align*}
                & \quad I \not\models \forall x.\, 3x = 2 \rightarrow x \leq 0 \\
                & \text{iff}\quad I \models \exists x.\, 3x = 2 \land \neg(x \leq 0) \\
                & \text{iff}\quad I \vartriangleleft \{ x \mapsto \textsf{a} \} \models 3x = 2 \land \neg(x \leq 0) \text{ for some $\textsf{a} \in \mathbb{Q}$}\\
                & \text{iff}\quad \text{There exists a rational number $a$ such that $3a = 2$ and $a \geq 0$}
            \end{align*}
            where the last line is clearly true since $3 / 2$ is such a rational number.
            Thus the given formula is invalid.
            In fact, it is unsatisfiable because no interpretation satisfies the formula.
    \end{enumerate}
\end{exer}

\begin{exer}[3.4]
    $ $
    \begin{enumerate}[label=(\alph*)]
        \item
            Let $I = (\alpha_I, D_I)$ be an interpretation with
            \begin{itemize}
                \item
                    $D_I = \{ \bullet \}$,
                \item
                    $\alpha_I[\atom](\bullet) = \true$,
                \item
                    $\alpha_I[\car](\bullet) = \bullet$,
                \item
                    $\alpha_I[\cdr](\bullet) = \bullet$,
                \item
                    $\alpha_I$ maps $\cons, \car, \cdr$ and $\atom$ so as to satisfy the axioms of $T_{\cons}$.
            \end{itemize}
            It is easy to see that this is indeed possible, and also it is clear that $I$ is indeed a $T_{\cons}$-interpretation.
            Note that the behavior of $\car$ and $\cdr$ on atoms is undefined as mentioned on P.85, so it is okay to declare it as we did above.
            \begin{align*}
                & \quad I \not\models \forall x, y, z.\, \car(x) = y \land \cdr(x) = z \rightarrow x = \cons(y, z) \\
                & \text{iff}\quad I \models \exists x, y, z.\, \car(x) = y \land \cdr(x) = z \land \neg(x = \cons(y, z)) \\
                & \text{iff}\quad J \models \car(x) = y \land \cdr(x) = z \land \neg(x = \cons(y, z)) \\
                & \text{iff}\quad J \models \car(x) = y \text{ and } J \models \cdr(x) = z \text{ and } J \not\models x = \cons(y, z) \\
                & \text{iff}\quad \alpha_J[\car](\bullet) = \bullet \text{ and }
                                  \alpha_J[\cdr](\bullet) = \bullet \text{ and }
                                  J \not\models x = \cons(y, z) \\
                & \text{iff}\quad J \not\models x = \cons(y, z)
            \end{align*}
            where $J: I \vartriangleleft \{ x \mapsto \bullet, y \mapsto \bullet, z \mapsto \bullet \}$.

            From the definition of $I$ and the axiom ($\atom$), we know that $J \models \atom(x)$ and $J \not\models \atom(\cons(y, z))$.
            Thus $J \not\models \atom(x) \leftrightarrow \atom(\cons(y, z))$.
            By taking the contrapositive of (\textsf{predicate congruence}) as mentioned on P.89, we obtain that $J \not\models x = \cons(y, z)$.

            Therefore, the last line is true, so $I$ is indeed a falsifying $T_{\cons}$-interpretation.
        \item
            We claim that $F$ is valid.
            Suppose otherwise.
            Let $I$ be a falsifying $T_{\cons}$-interpretation.
            \begin{enumerate}[label=\arabic*.]
                \item
                    $I \not\models \forall *.\, \neg\atom(x) \land \car(x) = y \land \cdr(x) = z \rightarrow x = \cons(y, z)$.
                \item
                    $I \models \exists *.\, \neg\atom(x) \land \car(x) = y \land \cdr(x) = z \land \neg(x = \cons(y, z))$.
                \item
                    $I_{\textsf{abc}} \models \neg\atom(x) \land \car(x) = y \land \cdr(x) = z \land \neg(x = \cons(y, z))$ for fresh \textsf{a}, \textsf{b}, \textsf{c}.
                \item
                    $I_{\textsf{abc}} \models \neg\atom(x)$.
                \item
                    $I_{\textsf{abc}} \models \car(x) = y$.
                \item
                    $I_{\textsf{abc}} \models \cdr(x) = z$.
                \item
                    $I_{\textsf{abc}} \models \neg(x = \cons(y, z))$.
                \item
                    $I_{\textsf{abc}} \models \cons(\car(x), \cdr(x)) = \cons(y, z)$. (by 5, 6 and (\textsf{function congruence})
                \item
                    $I_{\textsf{abc}} \models \cons(\car(x), \cdr(x)) = x$. (by 4 and (\textsf{construction})
                \item
                    $I_{\textsf{abc}} \models x = \cons(y, z)$. (by 8, 9, (\textsf{symmetry}), and (\textsf{transitivity}))
                \item
                    $I_{\textsf{abc}} \models \bot$. (by 7 and 10)
            \end{enumerate}
            Every branch of a semantic argument proof closes, so $F$ is valid.
    \end{enumerate}
\end{exer}

\begin{exer}[3.4]
    $ $
    \begin{enumerate}[label=(\alph*)]
        \item
            Let $I = (\alpha_I, D_I)$ be a $T_{\textsf{A}}$-interpretation with $D_I = \{ \bullet \}$.
            It is easy to see such an interpretation exists.
            We claim that $I$ is a falsifying interpretation.
            \begin{align*}
                &\quad I \not\models \forall i, j.\, a\ev{i \vartriangleleft e}[j] = e \rightarrow i = j \\
                &\text{iff}\quad I \models \exists i, j.\, a\ev{i \vartriangleleft e}[j] = e \land \neg(i = j) \\
                &\text{iff}\quad \text{There exist \textsf{v}, \textsf{w} such that } I_{\textsf{vw}} \models a\ev{i \vartriangleleft e}[j] = e \land \neg(i = j) \\
                &\text{iff}\quad \text{There exist \textsf{v}, \textsf{w} such that } I_{\textsf{vw}} \models a\ev{i \vartriangleleft e}[j] = e \text{ and } I_{\textsf{vw}} \models \neg(i = j) \\
            \end{align*}
            The last statement is true when we set $\textsf{v} = 0$ and $\textsf{w} = 1$, for instance.
            Note that since the cardinality of $D_I$ is 0, any \textsf{read} operation returns $\bullet$, and every constant is mapped to $\bullet$.
        \item
            Let $I = (\alpha_I, D_I)$ be a $T_{\textsf{A}}$-interpretation such that
            \begin{itemize}
                \item
                    $D_I = \{ 0, 1 \}$.
                \item
                    $\alpha_I[a][k] = k$ for each $k = 0, 1$.
                \item
                    $\alpha_I[e] = 1$.
            \end{itemize}
            It is easy to see that such an interpretation exists.
            We claim that it is a falsifying interpretation.
            \begin{align*}
                &\quad I \not\models \forall i, j.\, a\ev{i \vartriangleleft e}[j] = e \rightarrow a[j] = e \\
                &\text{iff}\quad I \models \exists i, j.\, a\ev{i \vartriangleleft e}[j] = e \land \neg(a[j] = e) \\
                &\text{iff}\quad \text{For some \textsf{v}, \textsf{w}}, I_{\textsf{vw}} \models a\ev{i \vartriangleleft e}[j] = e \text{ and } I_{\textsf{vw}} \models \neg(a[j] = e) \\
            \end{align*}
            If $\textsf{v} = \textsf{w} = 0$, then $\alpha_{I_{\textsf{vw}}}[a]\ev{0 \vartriangleleft 1}[0] = 1$ and $\alpha_{I_{\textsf{vw}}}[a][0] \ne 1$.
            Thereore, the last line is true, so $I$ is indeed a falsifying interpretation.
        \item
            Suppose that the formula is invalid.
            Let $I$ be a falsifying $T_{\textsf{A}}$-interpretation.
            \begin{enumerate}[label=\arabic*.]
                \item % 1
                    $I \not\models \forall i, j.\, a\ev{i \vartriangleleft e}[j] = e \rightarrow i = j \lor a[j] = e$.
                \item % 2
                    $I \models \exists i, j.\, a\ev{i \vartriangleleft e}[j] = e \land i \ne j \land a[j] \ne e$.
                \item % 3
                    $I_{\textsf{vw}} \models a\ev{i \vartriangleleft e}[j] = e \land i \ne j \land a[j] \ne e$ for fresh \textsf{v} and \textsf{w}.
                \item % 4
                    $I_{\textsf{vw}} \models a\ev{i \vartriangleleft e}[j] = e$.
                \item % 5
                    $I_{\textsf{vw}} \models i \ne j$.
                \item % 6
                    $I_{\textsf{vw}} \models a[j] \ne e$.
                \item % 7
                    $I_{\textsf{vw}} \models a\ev{i \vartriangleleft e}[j] = a[j]$. (by 5 and \textsf{(read-over-write 2)})
                \item % 8
                    $I_{\textsf{vw}} \models a[j] = e$. (by 4, 7, \textsf{(symmetry)} and \textsf{(transitivity)})
                \item %9
                    $I_{\textsf{vw}} \models \bot$. (by 6 and 8)
            \end{enumerate}
            Since every branch closes, the given formula must be valid.
    \end{enumerate}
\end{exer}
